<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Details</title>
</head>

<body>
    <h1>Welcome, User!</h1>

    <div id="user-details">
        <!-- User details will be displayed here -->
    </div>
    <button id="update">update</button>
    <div id="update-form">
        <div>
            <label for="userDisplayName">Display Name:</label>
            <input type="text" id="userDisplayName" name="userDisplayName">
        </div>
        <div>
            <label for="userPhotoURL">Photo URL:</label>
            <input type="text" id="userPhotoURL" name="userPhotoURL">
        </div>
        <div>
            <label for="userEmail">Email:</label>
            <input type="email" id="userEmail" name="userEmail">
        </div>
        <div>
            <label for="userPhone">Phone:</label>
            <input type="tel" id="userPhone" name="userPhone">
        </div>
        <div>
            <label for="userGender">Gender:</label>
            <input type="text" id="userGender" name="userGender">
        </div>
        <div>
            <label for="userAddress">Address:</label>
            <input type="text" id="userAddress" name="userAddress">
        </div>
        <div>
            <label for="userOrganization">Organization:</label>
            <input type="text" id="userOrganization" name="userOrganization">
        </div>
        <div>
            <label for="userDesignation">Designation:</label>
            <input type="text" id="userDesignation" name="userDesignation">
        </div>
    </div>
    <br>
    <button id="signout-button">Sign Out</button>


    <!-- Your Firebase configuration and initialization code -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
        import {
            getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc
        } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        try {
            const firebaseConfig = {
                apiKey: "AIzaSyDdNA85YFPLf8M3xO47wW-CE1O5UUBuOsk",
                authDomain: "userpage-33951.firebaseapp.com",
                projectId: "userpage-33951",
                storageBucket: "userpage-33951.appspot.com",
                messagingSenderId: "950594980527",
                appId: "1:950594980527:web:f536a29d10ed440367625a",
                measurementId: "G-3YBFCE7D36"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore();
            const userDetailsDiv = document.getElementById('user-details');
            const signoutButton = document.getElementById('signout-button');
            const update = document.getElementById('update');

            var userDisplayNameInput = document.getElementById("userDisplayName");
            var userPhotoURLInput = document.getElementById("userPhotoURL");
            var userEmailInput = document.getElementById("userEmail");
            var userPhoneInput = document.getElementById("userPhone");
            var userGenderInput = document.getElementById("userGender");
            var userAddressInput = document.getElementById("userAddress");
            var userOrganizationInput = document.getElementById("userOrganization");
            var userDesignationInput = document.getElementById("userDesignation");

            // Add an authentication state change listener
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log(user)

                    async function getdocument() {
                        var ref = doc(db, "userlist", user.uid)
                        const docSnap = await getDoc(ref)
                        if (docSnap.exists()) {
                            userDetailsDiv.innerHTML = `
                        <p><strong>profileURL:</strong>${docSnap.data().userphotourl}</p>
                        <img src="${docSnap.data().userphotourl}" alt="${docSnap.data().userdisplayname}" width="100" height="100">
                        <p><strong>User ID:</strong> ${docSnap.data().useruid}</p>
                        <p><strong>Name:</strong>${docSnap.data().userdisplayname}</p>
                        <p><strong>Email:</strong> ${docSnap.data().useremail}</p>
                        <p><strong>PhoneNumber:</strong> ${docSnap.data().userphone}</p>
                        <p><strong>gender: ${docSnap.data().usergender}</strong></p>
                        <p><strong>address:</strong>${docSnap.data().useraddress}</p>
                        <p><strong>organization:</strong>${docSnap.data().userorganization}</p>
                        <p><strong>designation:</strong>${docSnap.data().userdesignation}</p>
                        <!-- Add more user details here as needed -->
                    `;

                            userDisplayNameInput.value = docSnap.data().userdisplayname
                            userPhotoURLInput.value = docSnap.data().userphotourl
                            userEmailInput.value = docSnap.data().useremail
                            userPhoneInput.value = docSnap.data().userphone
                            userGenderInput.value = docSnap.data().usergender
                            userAddressInput.value = docSnap.data().useraddress
                            userOrganizationInput.value = docSnap.data().userorganization
                            userDesignationInput.value = docSnap.data().userdesignation

                        } else {
                            console.log("no data available")
                        }
                    }
                    getdocument()
                    signoutButton.style.display = 'block'; // Show the sign-out button
                    update.style.display = 'block';

                } else {
                    // User is signed out
                    userDetailsDiv.innerHTML = 'User is signed out.';
                    signoutButton.style.display = 'none'; // Hide the sign-out button
                    update.style.display = 'none';

                }

                update.addEventListener('click', () => {
                    async function updatedocument() {
                        var ref = doc(db, "userlist", user.uid)
                        await updateDoc(
                            ref, {

                            userdisplayname: userDisplayNameInput.value,
                            userphotourl: userPhotoURLInput.value,
                            useremail: userEmailInput.value,
                            userphone: userPhoneInput.value,
                            usergender: userGenderInput.value,
                            useraddress: userAddressInput.value,
                            userorganization: userOrganizationInput.value,
                            userdesignation: userDesignationInput.value
                        }
                        )
                            .then(() => {
                                alert("updated successfully")
                            }).catch((error) => {
                                alert("something went wrong " + error)
                            })
                    }
                    updatedocument()
                    // location.reload()
                });
            });


            // Add sign-out button functionality
            signoutButton.addEventListener('click', () => {
                // Sign out the user
                signOut(auth)
                    .then(() => {
                        // Redirect to the sign-in page or any other page as needed
                        window.location.href = 'login.html';
                    })
                    .catch((error) => {
                        console.error('Sign out error:', error);
                    });
            });



        }
        catch (error) {
            console.log('Firebase initialization error:', error);
        }



    </script>
</body>

</html>